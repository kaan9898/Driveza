<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Driveza | Cars</title>

    <link rel="stylesheet" th:href="@{/css/driveza-app.css}" />

    <!-- Page-only effects (safe, doesn't touch main CSS) -->
    <style>
        /* Background hero */
        .pageHero {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            padding: 22px;
            margin-bottom: 18px;
            background: #0b1220;
        }
        .pageHero::before{
            content:"";
            position:absolute; inset:0;
            background-image: url("/images/user-bg.jpg");
            background-size: cover;
            background-position: center;
            filter: saturate(1.05) contrast(1.05);
            opacity: .22;
        }
        .pageHero::after{
            content:"";
            position:absolute; inset:0;
            background: radial-gradient(1200px 400px at 20% 0%, rgba(255,255,255,.10), transparent 60%),
            linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
        }
        .pageHero__content{
            position: relative;
            display:flex;
            align-items:flex-start;
            justify-content: space-between;
            gap: 16px;
        }

        /* Animations */
        .fadeUp {
            animation: fadeUp .55s ease-out both;
        }
        @keyframes fadeUp{
            from{ opacity:0; transform: translateY(10px); }
            to{ opacity:1; transform: translateY(0); }
        }

        .cardPop {
            animation: cardPop .45s ease-out both;
        }
        @keyframes cardPop{
            from{ opacity:0; transform: translateY(12px) scale(.98); }
            to{ opacity:1; transform: translateY(0) scale(1); }
        }

        /* Hover effect for car cards */
        .carCard{
            transition: transform .15s ease, box-shadow .15s ease;
            will-change: transform;
        }
        .carCard:hover{
            transform: translateY(-2px);
            box-shadow: 0 10px 28px rgba(0,0,0,.18);
        }

        /* Filters sticky */
        .filtersSticky{
            position: sticky;
            top: 12px;
            z-index: 2;
        }

        /* Small badge tune */
        .badge{
            letter-spacing: .3px;
        }

        /* Empty state */
        .emptyState{
            text-align:center;
            padding: 26px;
        }
        .emptyState__title{
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        .emptyState__sub{
            opacity: .8;
            margin-bottom: 14px;
        }
    </style>
</head>

<body>

<!-- Top Bar -->
<header class="topbar fadeUp">
    <div class="topbar__left">
        <a class="brand" th:href="@{/cars}">
            <img class="brand__logo" th:src="@{/images/logo.svg}" alt="Driveza" />
            <span class="brand__name">Driveza</span>
        </a>
    </div>

    <nav class="topbar__nav">
        <a class="nav__link nav__link--active" th:href="@{/cars}">Cars</a>
        <a class="nav__link" th:href="@{/map}">Map</a>
        <a class="nav__link" th:href="@{/account}">Account</a>
    </nav>

    <form th:action="@{/logout}" method="post" style="display:inline;">
        <button class="btn btn--ghost" type="submit">Logout</button>
    </form>
</header>

<main class="container">

    <!-- HERO HEADER -->
    <section class="pageHero fadeUp">
        <div class="pageHero__content">
            <div>
                <h1 class="pageTitle" style="margin:0 0 6px 0;">Available Cars</h1>
                <p class="pageSub" style="margin:0;">
                    Only <b>AVAILABLE</b> cars are shown for users.
                </p>
            </div>

            <!-- active rental quick action -->
            <div class="activeRental">
                <div class="activeRental__label">My Rental</div>
                <div class="activeRental__value">No active rental</div>
                <button class="btn btn--small btn--disabled" type="button" disabled>Return</button>
            </div>
        </div>
    </section>

    <!-- Alerts -->
    <div class="alert alert--error" th:if="${param.error}">
        Something went wrong. Please try again.
    </div>
    <div class="alert alert--info" th:if="${param.success}">
        Action completed successfully.
    </div>

    <!-- Filters -->
    <section class="filters card filtersSticky fadeUp">
        <form class="filters__grid" method="get" th:action="@{/cars}">
            <div class="field">
                <label class="label">Search model</label>
                <input class="input" name="q" type="text"
                       placeholder="e.g., Prius, BMW X3"
                       th:value="${param.q}" />
                <input type="hidden" name="lat" id="lat" />
                <input type="hidden" name="lon" id="lon" />
            </div>

            <div class="field">
                <label class="label">Sort</label>
                <select class="select" name="sort">
                    <option value="" th:selected="${param.sort == null or param.sort[0] == ''}">Recommended</option>
                    <option value="distanceAsc" th:selected="${param.sort != null and param.sort[0] == 'distanceAsc'}">Distance (nearest)</option>
                    <option value="priceAsc" th:selected="${param.sort != null and param.sort[0] == 'priceAsc'}">Price (lowest)</option>
                </select>
            </div>

            <div class="field">
                <label class="label">Radius</label>
                <select class="select" name="radius">
                    <option value="1"  th:selected="${param.radius != null and param.radius[0] == '1'}">1 km</option>
                    <option value="3"  th:selected="${param.radius == null or param.radius[0] == '3'}">3 km</option>
                    <option value="5"  th:selected="${param.radius != null and param.radius[0] == '5'}">5 km</option>
                    <option value="10" th:selected="${param.radius != null and param.radius[0] == '10'}">10 km</option>
                </select>
            </div>

            <div class="filters__actions">
                <button class="btn" type="submit">Apply</button>
                <a class="btn btn--ghost" th:href="@{/cars}">Reset</a>
            </div>
        </form>

        <script>
            // optional: fill lat/lon for distance/radius filtering
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const latEl = document.getElementById("lat");
                    const lonEl = document.getElementById("lon");
                    if (latEl && lonEl) {
                        latEl.value = pos.coords.latitude;
                        lonEl.value = pos.coords.longitude;
                    }
                });
            }
        </script>
    </section>

    <!-- Cars Grid -->
    <section class="grid" style="margin-top:16px;">

        <!-- Empty state -->
        <div class="card pad emptyState" th:if="${#lists.isEmpty(cars)}">
            <div class="emptyState__title">No available cars right now</div>
            <div class="emptyState__sub">Try increasing the radius or clearing your filters.</div>
            <a class="btn" th:href="@{/cars}">Show all available</a>
        </div>

        <!-- Dynamic cards -->
        <article class="carCard cardPop" th:each="car, iter : ${cars}" th:style="'animation-delay:' + (${iter.index} * 50) + 'ms;'">
            <img class="carCard__img" th:src="@{/images/car-placeholder.jpg}" alt="car"/>

            <div class="carCard__body">
                <div class="carCard__top">
                    <div>
                        <div class="carCard__title"
                             th:text="${car.model != null ? car.model.brand + ' ' + car.model.model : 'Unknown Model'}">
                            Toyota Prius
                        </div>
                        <div class="carCard__meta" th:text="${car.type}">HYBRID</div>
                    </div>

                    <span class="badge badge--ok" th:text="${car.status}">AVAILABLE</span>
                </div>

                <div class="carCard__info">
                    <div class="infoRow">
                        <span class="muted">Price</span>
                        <b th:text="'€' + ${car.pricePerMin} + '/min'">€0.25/min</b>
                    </div>
                    <div class="infoRow">
                        <span class="muted">Lat</span>
                        <b th:text="${car.latitude}">56.9496</b>
                    </div>
                    <div class="infoRow">
                        <span class="muted">Lon</span>
                        <b th:text="${car.longitude}">24.1052</b>
                    </div>
                </div>

                <button class="btn" type="button">Rent</button>
            </div>
        </article>

    </section>

</main>

</body>
</html>